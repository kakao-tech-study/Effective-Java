### 이왕이면 제네릭 메서드로 만들라

보통 정적 유틸리티 메서드를 제네릭으로 만든다.

예를 들어 Collections의 sort와 같은 알고리즘 메서드 또한 제네릭이다.

```java
public static Set union(Set s1, Set s2) {
    Set result = new HashSet(s1);
    result.addAll(s2);
    return result;
}
```

위 코드를 보면 컴파일은 되지만, 경고가 발생하게 된다.

입력값 s1, s2와 리턴값의 타입이 명확하게 명시되지 않아서이다.

위 코드를 경고 없이 타입 안전하게 쓸 수 있도록 하려면 `Set` 을 `Set<E>` , 제네릭 메서드로 명시해주면 된다.

**그러면 왜 제네릭 메서드를 만들라고 하는것일까?**

`이왕이면 제네릭 메서드로 만들라` 라는 말 앞에 `입력 매개변수나 리턴값을 명시적으로 형변환해야 하는 메서드` 가 있으면 이제 이해가 좀 더 빨라진다.

자바에서 제네릭 메서드의 특징 중에는 `런타임에 타입 정보가 소거된다.` 라는 특징이 있다.

💡 **타입 소거란?**

자바에서 제네릭은 컴파일 타임에만 타입 검사를 수행한다.

런타임에서는 검사에 사용된 타입 정보가 사라진다.

즉, List<String>, List<Person> 등은 컴파일 시 서로 다른 타입처럼 보이지만 런타임에서는 그냥 List로 취급된다.

```java
List<String> stringList = new ArrayList<>();
List<Integer> integerList = new ArrayList<>();

System.out.

println(stringList.getClass() ==integerList.

getClass());// =>true를 반환한다.
```

하나의 객체를 어떤 타입으로든 매개변수화 하기 위해서는 그 객체의 타입을 바꿔주는 정적 팩터리를 만들어야 하며, 이를 제네릭 싱글턴 팩터리라 한다.

<img width="600" alt="Image" src="https://github.com/user-attachments/assets/8eb4c7f9-76e5-4d49-a5fa-c2a82995678f" />

Collections.reverseOrder() 메서드는 대표적인 제네릭 싱글턴 팩터리의 활용법이다.

코드를 보게 되면 `Comparators.NaturalOrderComparator.INSTANCE` 나 `ReverseComparator.REVERSE_ORDER` 와 같은 객체들은 싱글턴 인스턴스로 단 하나의
객체이다.

매번 이 객체를 제네릭으로 감싸서 요청한 타입의 `Comparator<T>` 로 반환한다.

**장점은 무엇일까?**

Collections의 다양한 알고리즘 메서드를 사용할 때, String, Integer, Long 등 다양한 타입에 대해서 런타임에서는 어차피 똑같은데 굳이 다양한 인스턴스를 만들어 사용해야할까?

이러한 부분에서 제네릭 싱글턴 팩터리의 장점을 확인할 수 있다.

1. 같은 역할을 수행하는 객체에 대해 하나의 인스턴스를 재사용하며 메모리를 절약
2. 객체를 새로 만들 필요 없기 때문에 객체 생성 비용을 아끼며 객체 생성에 사용되는 리소스 절감을 통한 성능 최적화
3. 정적 팩터리 메서드에서 제네릭으로 감싸서 반환하기 때문에 적절한 타입으로 안전하게 사용된다.
   ⇒ 내부적으로 안전한 형변환을 수행하며, unchecked cast를 컴파일러는 경고하지만, 실제로는 타입 안전하게 사용할 수 있도록 보장하는 것을 확인할 수 있다.

여기서 일부 모순처럼 느껴진 부분이 있었다.

초반에 제네릭 메서드로 만들라고 권장하면서도 내부에서는 형변환을 해주는게 대표적인 제네릭 싱글턴 팩터리라고 하는걸까?

**타입 소거의 한계**

1. 런타임에는 타입 정보가 사라지기 때문에 실제 객체는 타입에 구애받지 않는다.
2. 따라서 컴파일러에게 이 객체를 이 타입으로 안전하게 다뤄도 된다고 알려주기 위한 형변환이 필요하다.

제네릭 메서드로 만들어서 타입 안정성을 확보하려고 하는것이 맞지만, 런타임 타입 소거라는 제약으로 인해 명시적 형변환이 필요한다.

그래서 이를 바탕으로 정리하자면

`입력 매개변수나 리턴값을 명시적으로 형변환해야 하는 메서드는 이왕이면 제네릭 메서드로 만들라`  라고 할 수 있다.
